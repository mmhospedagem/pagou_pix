<?php

require_once(dirname(__FILE__) . "/init.php");
require_once(dirname(__FILE__) . "/modules/gateways/pagou_pix/vendor/autoload.php");

// Define o horario padrÃ£o do sistema
date_default_timezone_set('America/Sao_Paulo');

//////////////////////////////////////////////////////////////////////////////////////////
// API Carbon ////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////

use Carbon\Carbon;

//////////////////////////////////////////////////////////////////////////////////////////
// API Laravel DataBase //////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////

use WHMCS\Database\Capsule;

//////////////////////////////////////////////////////////////////////////////////////////
// API WHMCS Gateway 8.0.0 ///////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////

use WHMCS\Module\GatewaySetting;

//////////////////////////////////////////////////////////////////////////////////////////
// API PAGOU MMHOSPEDAGEM ////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////

use MMHospedagem\App\Pagou\Pix;

//////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////

if(($_GET["metodo"] == "pix")) {

    $ExistePix = Capsule::table('pagou_pix_cobrancas')->where(['invoice' => $_GET["id"]])->orderBy("id", "desc")->limit(1)->first();

    $json = base64_decode($ExistePix->json);
    $json = json_decode($json, true);

    $imagem = $json["payload"]["image"];
    $imagem = base64_decode($imagem);

    header('Content-Type: image/png');
    print_r($imagem);
    
    exit();

}